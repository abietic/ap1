# 秒杀项目ap1

## 秒杀项目特点与处理方式

秒杀项目的场景为在一瞬间有大量请求涌入.这可能使硬件资源的占用率瞬间到达接近100%,导致由于资源不足带来的类似死锁的现象(如M < N * (R - 1) + 1),使服务器卡死宕机.

为了使服务能在秒杀场景下正常运行,有两种解决途径.

一种是通过优化代码或是结构来增加服务端的QPS(比如,静态内容与动态请求分离;开启多个后端服务通过nginx的反向代理与负载均衡来分散请求;通过加入多级缓存和异步操作提高单次请求的处理速度和资源占用).

另一种方式是削峰,又分为几种解决方式.一种是通过验证码等机制(如秒杀订单令牌)实现请求发送方的发送请求速度降低.一种是延后峰值请求的处理时间,虽然问题是由于请求大量涌入造成的,但是也不是一定要在最忙的时候将所有请求全部完成(比如,限制服务端同时处理请求任务的数量,超出的部分进行排队等待).还有一种就是如果延后峰值的方式服务端也难以承受请求量,那么服务端就会将到来的过量无法处理的请求快速拒绝掉(如令牌数量大闸;leaky bucket限制QPS),毕竟服务较慢地正常工作也比由于峰值请求直接宕机要能够接受.

## 用户下单流程

1. 首先用户需要登录才能正常进行操作.由于使用nginx进行反向代理与负载均衡,设置了spring使用redis存储session信息来解决状态保存.并且使用CAS进行统一认证登录.
2. 用户通过统一认证登录的方式完成登录后,会同时将用户的相应信息存入对应的session中为之后的服务使用.
3. 用户选择想要购买的商品进入商品详情页面
4. 用户对处于秒杀阶段的商品进行下单操作
5. 用户输入验证码验证自己的下单操作,得到相应的秒杀下单令牌
6. 用户通过得到的秒杀下单令牌对商品进行下单.
7. 服务器的下单操作将数据库数据进行异步更新,减少服务端同步操作次数,加速响应速度.
<!-- TODO -->